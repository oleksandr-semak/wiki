<nav class="wiki-sidebar">
  <h3>Contents</h3>
  <ul class="sidebar-nav">
    {% for item in site.data.navigation.sidebar %}
    {% assign is_active = false %}
    {% if page.url == item.url %}{% assign is_active = true %}{% endif %}
    {% if item.children %}
      {% for child in item.children %}
        {% if page.url == child.url %}{% assign is_active = true %}{% endif %}
        {% if child.children %}
          {% for grandchild in child.children %}
            {% if page.url == grandchild.url %}{% assign is_active = true %}{% endif %}
          {% endfor %}
        {% endif %}
      {% endfor %}
    {% endif %}
    <li class="sidebar-item">
      {% if item.children %}
      <span class="sidebar-toggle {% if is_active %}open{% endif %}" onclick="this.classList.toggle('open'); this.nextElementSibling.classList.toggle('expanded');">{{ item.title }}</span>
      <ul class="sidebar-children {% if is_active %}expanded{% endif %}">
        {% for child in item.children %}
        {% assign child_active = false %}
        {% if page.url == child.url %}{% assign child_active = true %}{% endif %}
        {% if child.children %}
          {% for grandchild in child.children %}
            {% if page.url == grandchild.url %}{% assign child_active = true %}{% endif %}
          {% endfor %}
        {% endif %}
        <li class="sidebar-child">
          {% if child.children %}
          <span class="sidebar-toggle {% if child_active %}open{% endif %}" onclick="this.classList.toggle('open'); this.nextElementSibling.classList.toggle('expanded');">{{ child.title }}</span>
          <ul class="sidebar-grandchildren {% if child_active %}expanded{% endif %}">
            {% for grandchild in child.children %}
            <li class="sidebar-grandchild">
              <a href="{{ grandchild.url | relative_url }}" {% if page.url == grandchild.url %}class="active"{% endif %}>{{ grandchild.title }}</a>
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <a href="{{ child.url | relative_url }}" {% if page.url == child.url %}class="active"{% endif %}>{{ child.title }}</a>
          {% endif %}
        </li>
        {% endfor %}
      </ul>
      {% else %}
      <a href="{{ item.url | relative_url }}" {% if page.url == item.url %}class="active"{% endif %}>{{ item.title }}</a>
      {% endif %}
    </li>
    {% endfor %}
  </ul>
</nav>
